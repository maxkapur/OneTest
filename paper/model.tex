%!TEX encoding = UTF-8 Unicode 
% !BIB program = biber
\documentclass[12pt]{article}
\usepackage{geometry}
\geometry{a4paper, margin=2.5cm} 
%\usepackage[parfill]{parskip} 
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{setspace}
\usepackage{caption}
\usepackage{cancel}
\setstretch{1.2}
\usepackage{graphicx}
\DeclareGraphicsExtensions{.pdf,.png,.jpg}
\usepackage{relsize}
\usepackage{times}
\usepackage{letltxmacro}

\usepackage[reflist=true,style=windycity]{biblatex}
\addbibresource{refs.bib}

\newtheorem{theorem}{Theorem}
\newtheorem{proposition}{Proposition}

\theoremstyle{definition}
\newtheorem{definition}{Definition}
\newtheorem{algorithm}{Algorithm}

\title{Admissions markets with single scoring and multinomial logit student preferences}
\date{\today}
\author{Max Kapur}
\begin{document}

\maketitle

\pagebreak
\tableofcontents

\pagebreak
\section{Introduction}
The classical \emph{school choice problem} is a one-to-many stable assignment problem. Given a set of students and a set of schools, each student supplies her ranked preferences over the schools (typically without ties), and each school supplies its ranked preferences over the students (sometimes allowing for ties). Using a deferred acceptance algorithm in conjunction with a tiebreaking rule, the school board computes a \emph{stable assignment} of students to schools, or one in which every school that rejects students fills its capacity with students equal to or better than other students who prefer that school to the school to which they are matched.

Recently, attention has shifted toward a nonatomic formulation of this problem in which individual students are replaced with a distribution of students over the space of possible preference lists and scores. The nonatomic formulation, due to Azevedo and Leshno \parencite*{supplydemandfw}, enables the characterization of assignment policies, including stable assignments, via school admissions cutoffs, which indicate a score threshold above which all students have the option of attending the school in question. Current research in school choice problems takes advantage of the nonatomic formulation because it can be interpreted as the limit of the discrete assignment problem as the number of students and seats increases to infinity; thus, score cutoffs in the nonatomic formulation are free of the ``noise'' associated with discretization. 

However, formulating school choice problems in terms of cutoffs rather than stable assignments is also an opportunity to greatly generalize the purview of school choice research. In actuality, most admissions markets are not run by a central agency. Instead, they are dynamic: colleges can admit or reject students as they please, although it is safe to assume that to the extent that a given college can derive a partial preference order over the set of its applicants, it will admit the subset that exceeds a certain score cutoff rather than an arbitrary subset from all over the map. 

The cutoff formulation also creates space for the possibility that schools may have goals other than filling their capacity. They may not even have a meaningful limit on capacity, as is the case for many online schools.

In this dynamic situation, that paper offers a theoretical description of the relationship between supply and demand and posits a few comparative statics. However, it doesn't concern itself with computation, neither of the location of the equilibrium nor of the statics themselves. 

The one computable instance it does consider is with completely iid preferences on the part of the schools. then it provides expressions for comparative statics and a theoretical discussion about when negative incentives can arise.

It is this computational question to which I turn. I propose a continuous model that is both computationally tractable, moderately realistic, and versatile enough to accommodate not just centralized markets that used a DA procedure but also dynamic markets in which schools freely admit and reject students.

This model enables us to actually compute useful comparative statics. 

Moreover, it is realistic xyz.

\section{Preliminaries}
Before specifying the market used in this paper, I will define a nonatomic admissions market and summarize some important theoretical results.

\subsection{Admissions markets}
\begin{definition} An \emph{admissions market} consists of a set of schools $C = \{ 1\dots |C| \}$ and a mass-1 continuum of students over the set $S$ of student types. The market is characterized by four parameters:
\begin{enumerate}
\item The measure $\eta: S \mapsto [0, 1]$ over the continuum of students.
\item The score cutoff vector $p \in [0, 1]^C$. 
\item The demand vector $D \in [0, 1]^C$.
\item The capacity vector $q \in \mathbb{R}_{++}^C$.
\end{enumerate}
\end{definition}

The model is \emph{nonatomic} in that it represents students as a probability measure over the set of student types instead of considering individual students as discrete actors. Each point $s$ in the set of student types $S$ is associated with a preference list over the schools $>_s$ and a percentile score at each school $\theta_{sc} \in [0,1]$. Hence, $S = C! \times [0, 1]^C$. 

Schools marginally prefer students with higher scores. Their admissions decisions are represented by the score cutoff vector $p$. Any student for whom $\theta_{sc} \geq p_c$ is said to be \emph{admitted} to school $c$. 

The demand vector represents the number of students who enroll at each school. Assume that each student attends her favorite school among the set of schools to which she is admitted, which is called her \emph{consideration set} $C^\# \in 2^C$. Then the demand for school $c$ is a function of $p$ and $\eta$; specifically, it is the measure of students who are admitted to school $c$ but not admitted to any school that they prefer to $c$:
\begin{equation} \label{demanddefinition}
D_c \equiv \eta\left(s: c = \arg \max_{>_s} \left\{\hat c: e_{\hat c}^s \geq p_{\hat c} \right\}\right)
\end{equation}
Observe that $D_c$ is weakly decreasing in $p_c$ and weakly increasing in $p_{c'}$ for $c' \neq c$. Furthermore, if the preference lists are independent of the score vectors and the marginal distribution of scores at each school has full support (alternatively, if $\eta$ has full support), then $D_c$ is strictly decreasing in $p_c$ and strictly increasing in $p_{c'}$ for $c' \neq c$. Intuitively, this means that the margin of students who would choose to attend $D_c$ if its cutoff decreased is never empty. Finally, observe that $p_c = 1 \implies D_c = 0$ regardless of the other schools' cutoffs.

If the preference lists are independent of the score vectors, the demand can also be expressed as the sum of the demand from each combination of preference list and consideration set:
\begin{align*}D_c = 
\sum_{>_s \in C!} \sum_{\substack{C^\# \in 2^{C}:\\ c \in C^\#}}
\eta\Big(\;s:&~~\underbrace{e_{c'}^s \geq p_{c'}, \forall c' \in C^\#}_{\text{got into schools in } C^\# } \\
\text{ and} &~~\underbrace{e_{c''}^s < p_{c''}, \forall c'' \in C \setminus C^\#}_{\text{rejected elsewhere}} \\
\text{ and} &~~\underbrace{c >_s \hat c, \forall \hat c \in C^\#\setminus \{c\}}_{\text{prefers } c \text{ among } C^\#} \;\Big)
\end{align*}
This expression yields immediate insight into the complexity of nonatomic admissions markets. When schools are allowed to set their own cutoffs, and students are given free choice among the schools in their consideration sets, the number of terms in the sum above is $|C|!\times2^{|C|}$. However, such a general characterization of students is not always needed. The model considered in this paper, described in \S\ref{modeldescription}, characterizes $S$ using only $|C|$ parameters.

Each school's capacity $q_c > 0$ represents the fraction of the total mass of students that the school can accept. The capacity is used to define the notion of equilibrium below.

Assume that students prefer to be assigned to any school, even their last choice, than to remain unassigned. This is without loss of generality; if some students prefer to be unassigned than attend a particular school, then this choice can be incorporated into the model by adding a dummy school, representing nonassignment, with arbitrary large capacity. 

Assume that almost no ties occur among scores at a given school. That is, for any fixed $c$ and constant $\bar \theta$, $\eta( s: \theta_{sc} = \bar \theta) = 0$. It follows that the demand is continuous in $p$. 

\subsection{Notion of equilibrium}
Let's consider a notion of equilibrium that turns out to have several realistic interpretations. 

\begin{definition} \label{marketeqconditions} An admissions market is in \emph{equilibrium} if the following conditions hold:
\begin{align} D_c &\leq q_c, \quad \forall c \label{capacitycondition} \\
D_c &= q_c, \quad \forall c: p_c > 0 \label{stabilitycondition}
\end{align}
The first condition, called the \emph{capacity condition,} says that no school's demand exceeds its capacity. The second, called the \emph{stability condition,} says that if a school is rejecting students, it must be at full capacity.
\end{definition}

Using the sign constraint on $p$ and the capacity condition, an equivalent to the stability condition is $D_c < q_c \implies p_c = 0$ or $p^T \left(D - q\right) = 0$.

As shown below, a sufficient condition for the existence of the equilibrium is that the demand is continuous in $p$. A sufficient condition for the uniqueness of the equilibrium is that the demand is strictly decreasing in $p$. As discussed above, both of these conditions are met if the preference lists are independent of the score vectors and the marginal distribution of scores at each school has full support.
%The following assumptions ensure the existence of the equilibrium: First, restrict domain of $p$ to $[0,1]$. Demand decreasing in $p$. Full support in $\eta$. 

\subsection{Interpretation of the equilibrium conditions}
The applicability and interpretation of the equilibrium conditions depends on the design of the admissions markets. I offer four interpretations, moving from theoretical to practical. The first interpretation establishes a sufficient condition for the existence of the equilibrium. 

In all cases, assume the distribution of student types $\eta$ and the school capacities $q$ are fixed; thus the demand $D(p)$ is determined entirely by the cutoffs $p$. 

\subsubsection{As a fixed point of a t\^{a}tonnement process}
Suppose that each school has set an admissions target of $q_c$ and observes its demand from year to year. If more than $q_c$ students enroll, then the school attempts to reduce remand by increasing its cutoff. If fewer than $q_c$ students enroll, the school attempts to increase demand by lowering its cutoff (but not past zero). 

Let $Z(p) \equiv D(p) - q$ denote the excess demand vector. Then the process described above implies the following recursive relation between the cutoff vector in year $k$ and in year $k+1$:
\[p_c^{(k+1)} = \max\biggl\{0,~p_c^{(k)}+ \Gamma_c\Bigl[Z_c\bigl(p^{(k)}\bigr)\Bigr] \biggr\}\]
where $\Gamma$ is sign-preserving. A dynamic process like this one, in which prices adjust in the direction of excess demand, is called a \emph{t\^{a}tonnement process}.
\begin{theorem}
If $\bar p$ is a fixed point of the t\^{a}tonnement process, then it satisfies the equilibrium conditions. The converse also holds.
\end{theorem}
\textbf{Proof.} Pick $\bar p$ such that $\bar p = \max\bigl\{0, \bar p_c + \Gamma_c\left[Z_c(\bar p)\right] \bigr\}$. Subtract $\bar p_c$ from both sides to obtain $0 = \max\bigl\{-\bar p_c,\Gamma_c\left[Z_c(\bar p)\right] \bigr\}$, which implies $0 \geq \Gamma_c\left[Z_c(\bar p)\right] \bigr\}$. This means that the excess demand is negative, which establishes the capacity condition. Now, suppose $\bar p_c > 0$; then $\bar p_c =  \bar p_c + \Gamma_c\left[Z_c(\bar p)\right] $ establishes the stability condition $Z_c(\bar p = 0)$. Hence, any fixed point of the t\^{a}tonnement process is an equilibrium. 

As for the converse, if $p^{(k)}$ satisfies the equilibrium conditions, it is easy to verify that $p^{(k+1)} = p^{(k)}$. \hfill  $\square$

Moreover, if the demand function is continuous in $p$, then Brouwer's fixed-point theorem guarantees that a fixed point exists. (Observe that the cutoff update maps the convex set $[0, 1]^C$ to itself.) This means that continuous demand is sufficient for the existence of an equilibrium in admissions markets. 

Quantitative economists have studied t\^{a}tonnement processes extensively. For an introduction, see Codenotti and Varadarajan \parencite*{compmkteq} or Intriligator \parencite*[][chap. 9]{mathematicaloptandecontheory}. A classical proof of various convergence conditions is Uzawa \parencite*{walrastatonnement}. 

\subsubsection{As a competitive (Nash) equilibrium}
% Perhaps rewrite these utility functions in terms of p
Suppose that each school's capacity $q_c$ is a physical constraint on the number of students it can admit. Each school would like to recruit as many students as possible. However, if more students choose to attend the school than the school has capacity for, it must rent additional classroom space at considerable expense per student. That is, each school has a piecewise utility function $u_c(D_c)$ that is increasing in the demand when $0 \leq D_c \leq q_c$ but decreasing when $D_c > q_c$, and $\lim_{D_c \to q_c^+} u_c(D_c) \leq u_c(q_c)$. 

Another scenario in which utility functions with this shape may arise is as follows: Schools' utility functions are mostly by the number of students they enroll and, to a lesser extent, by their average score. If the demand for a school is less than its capacity, then a marginal student is always desirable. On the other hand, if the demand exceeds the capacity, then the school has no ability to procure space for the excess demand. Instead, it allows students to register on a first come, first served basis. Because the set of registered students is a random subset of the students who attempt to enroll at the school, it provides the school with less overall utility than if it handpicked the $q_c$ students with the highest scores. That is, when $D_c >q_c$, $u_c$ is increasing in $p_c$, and therefore decreasing in $D_c$. 

In both of these situations, the admissions market equilibrium can be interpreted as a Nash equilibrium. 
\begin{theorem}
Consider the game in which each school picks a cutoff $p_c \in [0,1]$ and tries to maximize a utility function $u_c(D_c)$ that is increasing in the demand when $0 \leq D_c \leq q_c$ but decreasing when $D_c > q_c$, and $\lim_{D_c \to q_c^+} u_c(D_c) \leq u_c(q_c)$.

If $p^*$ satisfies the equilibrium conditions, then it is the Nash equilibrium of the game above. The converse also holds.
\end{theorem}
\textbf{Proof.} Suppose $p^*$ satisfies the admissions market equilibrium conditions. For the schools for which $D_c = q_c$, their utility is globally maximal. For a school for which $D_c < q_c$, the only way for the school to increase its utility is to decrease its cutoff, but $p_c^* = 0$ by assumption. Hence, is incentivized to change its cutoff, and $p^*$ is a Nash equilibrium of the game defined by the schools' utility functions and the action space $p_c \in [0, 1]$. Furthermore, it can be seen that if the utility functions are strictly increasing or decreasing in the situations described above, then any Nash equilibrium is an admissions market equilibrium. \hfill $\square$

As an aside, observe both of the above are natural situations in which the t\^{atonnement} dynamics may arise.

\subsubsection{As a market-clearing cutoff vector}
Consider a semicentralized admissions procedure similar to the one used for college admissions in South Korea. In order to ensure an even geographic distribution of students, the government places a firm limit $q_c$ on the number of students who can attend each university. At the beginning of the admissions cycle, colleges are given the profiles of all the students interested in attending. Each college makes admissions offers over the course of several rounds, beginning with the highest-qualified students, and at each round a subset of the admitted students tentatively commit to attending one of the colleges that admitted them. Continuing in this manner, colleges continue lowering their cutoffs and offering admission to new students until either they fill their capacity, or lowering the cutoff fails to elicit an increase in demand. That is, the process terminates when the \emph{market clears:} There may be empty seats at some schools or some students who were admitted nowhere, but never both. The total number of assigned students is $\min\{\sum_c q_c, 1\}$.

Call the final vector of admissions cutoffs $\hat p$. If we assume that student preference lists are independent of their scores and that the marginal distribution of scores at each school has full support, then it follows that market-clearing cutoffs $\hat p$ satisfy the equilibrium conditions. The capacity condition holds at $\hat p$, because colleges are prohibited from lowering their cutoffs beyond the point where the demand equals the capacity. The stability condition also holds: Suppose (for a contradiction) that at the end of the final round, there is a school which has both remaining capacity (that is, $D_c < q_c$) and a positive cutoff $\hat p_c > 0$. By the full support assumption on the marginal score distribution, the set of marginal students at $c$ is nonempty. Hence, if $c$ lowers its cutoff, it can attract additional students. This contradicts the stopping criterion.

The previous paragraph establishes the following theorem:
\begin{theorem}
If $\hat p$ is a market-clearing cutoff vector obtained from the semicentralized admissions procedure, then it satisfies the equilibrium conditions.
\end{theorem}
The semicentralized admissions procedure can be interpreted as a t\^{a}tonnement process in which the initial cutoffs are a vector of ones, or as a distributed school-proposing deferred acceptance process, discussed below.

\subsubsection{As a stable assignment}
The notion of a stable assignment has its roots in the field of mechanism design and emerges most naturally from a \emph{centralized school choice process} in which students and schools submit their preference lists to the school board, and the school board determines the assignment of students to schools. First, I define the class of assignments the school board may consider.
\begin{definition}
A school choice \emph{assignment} is a mapping $\mu: S \to C \cup \{c_0\}$ that respects schools' capacity constraints. Namely, $\eta (s: \mu(s) = c) \leq q_c, \forall c \in C$. $\mu(s) = c_0$ represents nonassignment.
\end{definition}



It turns out we can state this result more strongly: By Lemma 1 of Azevedo and Leshno, there is a one-to-one relationship between market-clearing cutoff vectors and stable assignments.

The notion of stable assignments applies to a *centralized school-choice process* in which students submit their preference lists to a central agency that computes a match using the DA process, namely ...

The motivation for using the DA algorithm is that resulting match is stable, which means ...

Part 1 of the lemma says that the stable match is characterized by cutoffs that meet the equilibrium conditions above. A 

(Copy in material from DAM document.)

Moreover, any stable matching is associated with a set of cutoffs that satisfies the equilibrium criterion.

(proof)

Thus, another way to see that market-clearing cutoff vectors in the semicentralized admissions procedure satisfy the equilibrium conditions is to recognize that the iterative admissions process described above is equivalent to the school-proposing deferred acceptance procedure. As each school lowers its cutoff, it effectively "proposes" to the set of students whose scores fell between the old and new cutoffs. Students then reject all schools but their favorite, and iteration continues until no rejections take place. Because the final assignment of students is stable, the equilibrium conditions must hold. 



\subsection{Equivalent formulations of the equilibrium conditions}
The conditions for a market-clearing cutoff vector given in Definition \ref{marketeqconditions} can be expressed in a few additional ways. Throughout this section I use \[F(p) \equiv -Z(p) = q - D(p)\]
to denote the excess supply vector at $p$. 

\subsubsection{Nonlinear complementarity problem}
By inspection, the market-clearing cutoff problem is equivalent to the following nonlinear complementarity problem:
\begin{align*}
\text{find } p:\quad F(p)^T p & = 0 \\[0.5em] F(p) &\geq 0 \\[0.5em] p & \geq 0
\end{align*}

\subsubsection{Variational inequality problem}
By a canonical result, the following variational inequality problem is also equivalent:
\begin{align*}
\text{find } p \geq 0:\quad F(p)^T (\pi-p) \geq 0, \quad \forall \pi \geq 0
\end{align*}
If $D$ is strictly decreasing in $p$, then $F$ is strictly increasing, and $p^*$ is unique.

\subsection{Optimization tasks}
Give this a better title. Simply list possible optimization tasks. 










\section{Single-score model with multinomial logit preferences} \label{modeldescription}
This model consideries a special kind of admissions market that has not received much attention in the school-choice literature but approximates the admissions procedure used in many systems around the world.

\subsection{Characterization of $\eta$}

To characterize $\eta$, we must describe both how schools rank students, and how students rank schools.

In a \emph{single-score model,} all schools share the same ranking over the students. A single-score system may arise in one of several real-world scenarios. The most obvious case is a centralized admissions market, similar to that used in China, in which the government requires schools to admit students solely on the basis of a single standardized test. Alternatively, if students are scored using various dimensions of student characteristics such as test scores, GPA, and the quality of their letters of recommendation, it is common for these various dimensions to correlate tightly. If so, then principle component analysis can be used to determine a composite score whose order approximates the ordering of students at each university.

%Finally, in a centralized school choice lottery that uses single tiebreaking to assign a random priority ranking to each student and students are matched to their favorite schools in priority order, the single-score model is ... argue for realism

Regardless of the device used to generate the single scores, taking percentile scores over the final distribution allows us to assume that the scores are uniformly distributed on the interval $[0,1]$. 

As for students' choice of school, this paper assumes students use \emph{multinomial logit} (MNL) choice to derive their preference lists. This means that each school has a given preferability parameter $\delta_c$. Letting $C^\# \subseteq C$ denote set of schools to which a given student is admitted, she chooses to attend school $c \in C^\#$ with
\[\frac{\exp \delta_c}{\sum_{d \in C^\#} \exp \delta_d}\]
For convenience, let $\gamma_c \equiv \exp \delta_c > 0$ and $\Gamma = \sum_c \gamma_c$. Since the equation is homogeneous in $\gamma$, we may assume without loss of generality that $\Gamma = 1$; however, I will resist this assumption since many parameter-estimation techniques for MNL choice do not use it. 

\subsection{Demand function}
Let's derive the demand function $D(\gamma, p)$ for the single-score model with MNL student preferences.

First, sort the schools by cutoff, i.e. so that
\[p_1 \leq p_2 \leq \dots \leq p_{|C|}\]
Ties may be broken arbitrarily, as discussed below. Since getting into school $c$ implies getting into any school whose cutoff is less than or equal to $p_c$, there are only $|C| + 1$ possible consideration sets for each student: 
\begin{center}
\begin{tabular}{lll}
\textbf{Symbol} & \textbf{Consideration set} & \textbf{Probability} \\ \hline
$C_{[0]}$    & $\varnothing$    & $p_1$                  \\
$C_{[1]}$    & $\left\{ c_1 \right\}$    & $p_2 - p_1$               \\
$C_{[2]}$    & $\left\{ c_1, c_2 \right\}$    & $p_3 - p_2$               \\
$\vdots$ & $\vdots$ & $\vdots$ \\
$C_{[|C| - 1]}$           & $\left\{ c_1, \dots, c_{|C| - 1} \right\}$     & $p_{|C|} - p_{|C|-1}$             \\
$C_{[|C|]}$           & $\left\{ c_1, \dots, c_{|C|} \right\}$     & $1 - p_{|C|}$                 
\end{tabular}
\end{center}
Hence, the demand for school $c$ is the sum of the number of students with each of these consideration sets who choose to attend $c$. Letting $p_{|C|+1} \equiv 1$, that is
\begin{equation}D_c = \mathlarger{\mathlarger{\sum}}_{d=c}^{|C|} 
\underbrace{\frac{\exp{\delta_c}}{ \sum_{i=1}^d \exp{\delta_i}}}_{\substack{\text{prob. of choosing  }\\ c\text{ from assortment}}} 
\overbrace{\left(p_{d+1} - p_{d}\right)}^{\substack{\text{prob. of having}\\ \text{assortment }C_{[d]}}} 
\label{mnlonetestdemand}\end{equation}
If at least one school has $p_c = 0$, then every student can get in somewhere, and $\sum_c D_c = 1$. Generally, there are $p_1$ students who get in nowhere, and $\sum_c D_c = 1 - p_1$.

\subsubsection{Continuity and piecewise linearity of the demand function}
$D$ is \emph{continuous} in $p$. To see this, expand the equation above:
\scriptsize\[D_c = \gamma_c \left[ \left(\frac{-1}{\sum_{i=1}^c \gamma_i}\right) p_c
+ \left(\frac{1}{\sum_{i=1}^{c} \gamma_i} - \frac{1}{\sum_{i=1}^{c+1} \gamma_i} \right) p_{c+1}
%+ \left(\frac{1}{\sum_{i=1}^{c+1} \gamma_i} - \frac{1}{\sum_{i=1}^{c+2} \gamma_i}\right) p_{c+2}
+ \cdots
+ \left(\frac{1}{\sum_{i=1}^{|C|-1} \gamma_i} - \frac{1}{\sum_{i=1}^{|C|} \gamma_i}\right) p_{|C|}
+ \frac{1}{\sum_{i=1}^{|C|} \gamma_i}
\right]\]
\normalsize Since $D$ is linear in any neighborhood where the order of cutoffs is unambiguous, the only opportunity for discontinuity occurs when two or more cutoffs are equal. Thus, it suffices to show that the value of $D_c$ is independent of how ties among the $p_c$ are broken. Suppose that $p_j = \dots = p_{j+n} = \tilde p$ for some $j > c$. Then (moving $\gamma_c$ to the left for legibility),

\scriptsize \begin{align}
\frac{D_c}{\gamma_c} &= \cdots
+ \left(\frac{1}{\sum_{i=1}^{j-1} \gamma_i} - \frac{1}{\sum_{i=1}^{j} \gamma_i} \right) p_{j}
+ \left(\frac{1}{\sum_{i=1}^{j} \gamma_i} - \frac{1}{\sum_{i=1}^{j+1} \gamma_i} \right) p_{j+1}
%+ \left(\frac{1}{\sum_{i=1}^{j+1} \gamma_i} - \frac{1}{\sum_{i=1}^{j+2} \gamma_i}\right) p_{j+2}
+ \cdots
+ \left(\frac{1}{\sum_{i=1}^{j+n} \gamma_i} - \frac{1}{\sum_{i=1}^{j+n+1} \gamma_i}\right) p_{j+n}
+ \cdots \\
&= \cdots
+ \left(\frac{1}{\sum_{i=1}^{j-1} \gamma_i} - \cancel{\frac{1}{\sum_{i=1}^{j} \gamma_i}} \right) \tilde p
+ \left(\cancel{\frac{1}{\sum_{i=1}^{j} \gamma_i}} - \cancel{\frac{1}{\sum_{i=1}^{j+1} \gamma_i}} \right) \tilde p
%+ \left(\cancel{\frac{1}{\sum_{i=1}^{j+1} \gamma_i}} - \cancel{\frac{1}{\sum_{i=1}^{j+2} \gamma_i}}\right) \tilde p 
+ \cdots
+ \left(\cancel{\frac{1}{\sum_{i=1}^{j+n} \gamma_i}} - \frac{1}{\sum_{i=1}^{j+n+1} \gamma_i}\right) \tilde p
+ \cdots \\
&= \cdots
+ \left(\frac{1}{\sum_{i=1}^{j-1} \gamma_i} - \frac{1}{\sum_{i=1}^{j+n+1} \gamma_i}\right) \tilde p
+ \cdots
\end{align}

\normalsize The internal sums that depend on the order of the indices $j \dots j+n$ cancel out; hence, they may be arbitrarily reordered without changing the value of $D_c$. Similar canceling show that the demand does not vary under tiebreaking when $c$ itself is involved in a tie. Hence, $D$ is continuous. 

The expansion above also allows us to see that the demand vector is defined by the \emph{matrix equation}
\begin{equation}D = A p + \frac{1}{\Gamma}\gamma \label{demandmatrixeq}\end{equation}
where $A\in \mathbb{R}^{|C| \times |C|}$ is the triangular matrix with
\begin{align}A_{ij} &\equiv \begin{cases}
0, & i > j \\
-\gamma_i \left(\frac{1}{ \sum_{k=1}^i \gamma_k}\right), & i=j \\
\gamma_i \left( \frac{1}{\sum_{k=1}^{j-1} \gamma_k} -  \frac{1}{\sum_{k=1}^{j} \gamma_k}\right), & i<j \\
\end{cases} \label{Adef} \\[.8em]
\implies A &= \begin{bmatrix}
\gamma_1 \left( \frac{-1}{\gamma_1} \right) & \gamma_1 \left(\frac{1}{\gamma_1} - \frac{1}{\gamma_1 + \gamma_2} \right) & \gamma_1 \left(\frac{1}{\gamma_1 + \gamma_2} - \frac{1}{\gamma_1 + \gamma_2 + \gamma_3} \right) & \cdots &  \gamma_1 \left(\frac{1}{\sum_{i=1}^{|C| - 1}\gamma_i} - \frac{1}{\Gamma}  \right)  \\
 & \gamma_2 \left( \frac{-1}{\gamma_1 + \gamma_2} \right) & \gamma_2 \left(\frac{1}{\gamma_1 + \gamma_2} - \frac{1}{\gamma_1 + \gamma_2 + \gamma_3} \right) & \cdots &  \gamma_2 \left(\frac{1}{\sum_{i=1}^{|C| - 1}\gamma_i} - \frac{1}{\Gamma} \right)  \\
 &  & \gamma_3 \left( \frac{-1}{\gamma_1 + \gamma_2 + \gamma_3} \right) & \cdots &  \gamma_3 \left(\frac{1}{\sum_{i=1}^{|C| - 1}\gamma_i} - \frac{1}{\Gamma} \right)  \\
 & & & \ddots & \vdots \\
 &  &  &  &  \gamma_{|C|} \left(\frac{1}{\sum_{i=1}^{|C| - 1}\gamma_i} -\frac{1}{\Gamma}  \right)  \\
\end{bmatrix}\end{align}

Since $\gamma > 0$, $A$ is invertible. 

Because the matrix $A$ depends on the order of the $p_c$ values, the demand function is \emph{piecewise linear} in $p$.

\subsection{Appeal function}
Another interesting indicator from Azevedo and Leshno \parencite*{supplydemandfw} is the \emph{appeal} of a school's entering class, or the integral of scores over the set of admitted student. This is not necessarily the school's objective function, because schools may value an abstract notion of selectivity or students' tuition dollars higher than this value; however, as discussed above, the competitive equilibrium that arises when schools try to maximize appeal coincides with ...

The average score of a student with consideration set $C_{[d]}$ is $\frac{1}{2}\left(p_{d+1} + p_d\right)$, so the appeal at $c$ is

\begin{align}
L_c &= \sum_{d=c}^{|C|} 
\underbrace{\frac{{\gamma_c}}{ \sum_{i=1}^d {\gamma_i}}}_{\substack{\text{prob. of choosing  }\\ c\text{ from assortment}}} 
\overbrace{\left(p_{d+1} - p_{d}\right)}^{\substack{\text{prob. of having}\\ \text{assortment }C_{[d]}}} 
\underbrace{\frac{1}{2}\left(p_{d+1} + p_{d}\right)}_{\substack{\text{avg. score of students}\\ \text{with assortment }C_{[d]}}} \\
&=\frac{1}{2}\sum_{d=c}^{|C|} 
\frac{{\gamma_c}}{ \sum_{i=1}^d {\gamma_i}} 
\left(p_{d+1}^2 -  p_{d}^2\right)
\end{align}

By comparison with the expression for $D$, the quality vector is given by 
\[L = \frac{1}{2} A p.^2 + \frac{1}{2\Gamma} \gamma\]
where I have used the strange notation $p.^2 = (p_1^2, \dots, p_{|C|}^2)$ for the entrywise square of $p$.






\section{Unconstrained comparative statics}
Before I apply the notion of equilibrium to the market with single scoring and MNL student preferences, it is worthwhile to derive a few comparative statics results that apply to the unconstrained market---that is, when schools have no capacity constraints. This section makes no particular claim about what schools' objective functions are; rather, I simply compute the gradients of the demand and appeal functions with respect to $p$, and $\gamma$ using the relations $D = Ap + \gamma$ and $L = \frac{1}{2} A p.^2 + \frac{1}{2}\gamma$ and discuss their interpretations.

\subsection{Cutoff effects}
The change in demand in response to a change in cutoffs is the Jacobian of the demand function:
\[\mathbf{J}_p D = A \]
The diagonal is negative, meaning that each school's demand is decreasing in its cutoff (downward-sloping demand curves). The entries above the diagonal are positive, while those below the diagonal are zero. This means that each school $c$'s demand is increasing in the cutoffs of the \emph{more-selective} schools, but the cutoffs of \emph{less-selective schools} have no local effect on the demand at $c$.

Intuitively, this means that if all schools are equally preferable, a highly selective school has more market power than the others: If it increases its cutoff, it will cause many students to move onto another school. On the other hand, a school $c'$ that is less preferable than $c$ cannot affect $D_c$'s demand by changing its own cutoff, because any student currently admitted to $c$ was already admitted to $c'$, and chose $c$ instead. 

Observe also that $-1 = A_{11} < A_{22} < \dots < A_{|C||C|} < 0$. This says that the school with the most generous cutoff has the most power to increase its demand with a marginal decrease in $p_c$. Intuitively, this is because a student who gets into a school with a large cutoff gets into \emph{many} schools, so competition for this student is fiercer than for a student whose options are already limited by a low score.

Next, consider the change in the entering classes' \emph{appeal} in response to a change in cutoffs:
\[\mathbf{J}_p L = A\operatorname{diag}(p)\]
For $p_c > 0$, the cutoff effect on appeal has the same direction as the cutoff effect on demand. Intuitively, this suggests that if a school's goal is to maximize the appeal of its entering class, it will tend to try to lower its score cutoffs as much as it can, subject to constraints on its total demand. However, the magnitude of the incentive increases when $p_c$ is higher. This tends to counteract the market power effect described above: A school with a low cutoff has the power to attract more marginal students, but does so with little overall effect on the aggregate appeal of its entering class. In the extreme case, when $p_c = 0$, the appeal associated with a marginal student is exactly zero.

\subsection{Quality effects}
Differentiate the demand with respect to $\gamma$ to obtain the effect of a marginal change in quality:
\[\frac{\partial}{\partial\gamma_{\hat c}} D_c = \begin{cases}
\sum_{d=c}^{|C|} \frac{-\gamma_c}{\left(\sum_{i=1}^{d} \right)^2} \left(p_{d+1} - p_d \right), & \hat c < c \\
\sum_{d=c}^{|C|} \frac{1}{\left(\sum_{i=1}^{d} \right)}
    \left( 1 - \frac{\gamma_c}{\left(\sum_{i=1}^{d} \right)}\right)
    \left(p_{d+1} - p_d \right), & \hat c = c\\
\sum_{d=\hat c}^{|C|} \frac{-\gamma_c}{\left(\sum_{i=1}^{d} \right)^2} \left(p_{d+1} - p_d \right), & \hat c > c
\end{cases}\]

(Note that the $\hat c > c$ and $ \hat c < c$ cases differ in the starting index.) The demand for $c$ is predictably decreasing in the quality of the other schools and increasing in $\gamma_c$. 

A similar picture emerges when we differentiate the appeal with respect to $\gamma$:
\[\frac{\partial}{\partial\gamma_{\hat c}} L_c = \begin{cases}
\frac{1}{2}\sum_{d=c}^{|C|} \frac{-\gamma_c}{\left(\sum_{i=1}^{d} \right)^2} \left(p_{d+1}^2 - p_d^2 \right), & \hat c < c \\
\frac{1}{2}\sum_{d=c}^{|C|} \frac{1}{\left(\sum_{i=1}^{d} \right)}
    \left( 1 - \frac{\gamma_c}{\left(\sum_{i=1}^{d} \right)}\right)
    \left(p_{d+1}^2 - p_d^2 \right), & \hat c = c\\
\frac{1}{2}\sum_{d=\hat c}^{|C|} \frac{-\gamma_c}{\left(\sum_{i=1}^{d} \right)^2} \left(p_{d+1}^2 - p_d^2 \right), & \hat c > c
\end{cases}\]

\subsection{Interpretation of subdifferentials when multiple cutoffs are equal}
The derivatives given above are well-defined when the cutoffs are totally ordered. However, an edge case occurs when there is a tie among the cutoffs; then the subdifferential set is given by the convex hull of the Jacobians associated with the possible permutations of $p$. In this case, I argue that the best interpretation of the effect of an \emph{increase} in $p_c$ should be that associated with the permutation for which $c$ is indexed after schools with which its cutoff is tied. That is, because $p_c$ is "about to" become larger than the other cutoffs involved in the tie, break the tie in its favor. Likewise, to interpret a \emph{decrease} in a tied $p_c$, treat $p_c$ as the least member of the tied set.

By the same procedure used to show the continuity of $D$ above, it is easy to see that the quality effects are continuous across tiebreaking permutations of $p$. Hence, the argument of the previous paragraph is unnecessary in this case.






\section{Optimization tasks}
Compute the demand, and show how to actually do the following opt tasks 

\subsection{Computing the equilibrium}
In the market under consideration, the equilibrium conditions are

\begin{align} D = A p + \frac{1}{\Gamma}\gamma &\leq q \\
D_c = A_{c.} p + \frac{1}{\Gamma} \gamma_c &= q_c, \quad \forall c: p_c > 0\end{align}

Equilibrium exists and is unique by ....

Tatonnement procedure and convergence proof.

When sum of capacities lt 1, observe that D = q.

\subsubsection{T\^{a}tonnement algorithm}

\subsubsection{Closed-form expression for equilibrium when cutoff order is known}

Suppose that the order of the cutoffs at equilibrium is known beforehand; then $A$ is fixed, and it suffices to find the vector $p$ that meets the conditions above. 

The following theorem says that it suffices to solve the linear system given by the first condition for $p$ under the assumption that each school fills its capacity, then take the positive part.

\begin{theorem}When the optimal cutoffs are known to satisfy $p_1 \leq \cdots \leq p_{|C|}$, the vector
\[\hat p \equiv \left[A^{-1} (q - \frac{1}{\Gamma} \gamma) \right]^+\]
satisfies the equilibrium condition.\end{theorem}

\textbf{Proof.} First, it is not difficult to verify that the inverse of $A$ is
\[A^{-1} = \begin{bmatrix}
\frac{-1}{\gamma_1}\left( \gamma_1 \right) & -1 & -1 &\cdots & -1 \\
 & \frac{-1}{\gamma_2}\left( \gamma_1 + \gamma_2 \right) & -1 &\cdots & -1 \\
 & & \frac{-1}{\gamma_2}\left( \gamma_1 + \gamma_2 + \gamma_3 \right) &\cdots & -1 \\
 &  &  & \ddots & \vdots \\
 & & & &  \frac{-1}{\gamma_{|C|}} \Gamma \\
\end{bmatrix}\]
The demand at $\hat p$ is 
\begin{align}
D &= A \hat p + \frac{1}{\Gamma}\gamma \\
\iff \quad \hat p &= A^{-1} (D - \frac{1}{\Gamma} \gamma)
\end{align}
Let
\[\bar p = A^{-1} (q - \frac{1}{\Gamma} \gamma)\]
Since $\hat p = \bar p^+ \geq \bar p$, the above expressions imply
\[A^{-1} D \geq A^{-1} q \quad \implies \quad D \leq q\]
The right side follows from the fact that $A^{-1}$ is negative definite. This establishes the capacity condition. 

Now, we need to show that the demand equals the capacity when $p_c > 0$. Since the cutoffs are sorted, let $b$ denote the first nonzero cutoff. That is, $p_1 = \dots = p_{b-1} = 0$, and $0 < p_b \leq p_{b+1} \leq \dots \leq p_{|C|}$. Then the demand at $\hat p$ may be written
\begin{align}
D &= A \hat p + \frac{1}{\Gamma}\gamma \\
&= \sum_{i=1}^{|C|} A_{.i} \hat p_i + \frac{1}{\Gamma}\gamma  \\
&= \sum_{i=1}^{|C|} A_{.i} \left[A^{-1} \left(q - \frac{1}{\Gamma}\gamma\right) \right]_i^+ + \frac{1}{\Gamma}\gamma  \\
&= \sum_{j=b}^{|C|} A_{.j} \left[A^{-1} \left(q - \frac{1}{\Gamma}\gamma\right) \right]_j + \frac{1}{\Gamma}\gamma  \\
&= \left[\sum_{j=b}^{|C|} A_{.j} A_{j.}^{-1} \right] \left(q - \frac{1}{\Gamma}\gamma\right) + \frac{1}{\Gamma}\gamma  \\
&= \begin{bmatrix}
0_{b \times b} & T_{b \times (|C| - b)} \\
0_{(|C| - b) \times b} & I_{|C| - b} \\
\end{bmatrix} \left(q - \frac{1}{\Gamma}\gamma\right) + \frac{1}{\Gamma}\gamma  \\
\end{align}
where
\[T = \begin{bmatrix}
\frac{-\gamma_1}{\sum_{i=1}^{b-1} \gamma_i} & \cdots & \frac{-\gamma_1}{\sum_{i=1}^{b-1} \gamma_i} \\
\vdots & \cdots & \vdots \\
\frac{-\gamma_{b-1}}{\sum_{i=1}^{b-1} \gamma_i} & \cdots & \frac{-\gamma_{b-1}}{\sum_{i=1}^{b-1} \gamma_i}
\end{bmatrix}\]
For the schools with $p_c > 0$, the demand is
\begin{align}
D_c &=
\begin{bmatrix}
0& I
\end{bmatrix}_{c.} \left(q - \frac{1}{\Gamma}\gamma\right) + \frac{1}{\Gamma}\gamma \\
&= q_c
\end{align}
Hence, the stability criterion holds, and $\hat p$ is an equilibrium.

For reference, for the schools with $p_c = 0$, the demand is 
\begin{align}
D_c &=
\begin{bmatrix}
0& T
\end{bmatrix}_{c.} \left(q - \frac{1}{\Gamma}\gamma\right) + \frac{1}{\Gamma}\gamma  \\
&= \frac{-\gamma_c}{\sum_{i=1}^{b-1} \gamma_i} \sum_{j=b}^{|C|} \left(q_j - \frac{1}{\Gamma}\gamma_j\right)  + \frac{1}{\Gamma}\gamma_c \leq q_c
\end{align}
From this expression, we can derive the minimum value of $\gamma_c$ that will cause $c$ to meet its capacity. 

Note that when the sum of capacities is less than one, then $D = q$, and $0 < p^* = A^{-1} (q - \gamma)$. 

\subsubsection{A heuristic for the optimal cutoff order}
The expression for $\hat p$ given above does not constitute a closed-form solution to the equilibrium problem, because it presupposes that the optimal order of cutoffs is known beforehand. In actuality, this is not the case. However, there is a fairly reasonable heuristic that can be used to predict the optimal order of cutoffs. Then, using the value of $\hat p$ associated with the heuristically predicted order as the initial value in the t\^{a}tonnement procedure can speed its convergence.

The heuristic is as follows: The order of the entries of $p^*$ is approximately determined by the order of the entries of $\gamma - q$. Intuitively, this says that schools with high preferability and low capacity tend to have higher cutoffs at equilibrium.

This yields an improved tat algo.

Plots, examples.

\subsubsection{Validation}
Validate the results using deferred acceptance. 








\subsection{Reverse optimization of student preferences}
Compute gamma; show inductive procedure. Argue for the informational power of this gamma. 



\section{Comparitive statics at equilibrium} \label{compstateq}
The comparative statics derived above apply to an unconstrained 
\subsection{At equilibrium: Demand effects}
On cutoff when quality is fixed

Effect of a change in total student population


\section{Extensions}
Propose my general form of the dynamic admissions market.

Equivalent problems to equilibrium:
- variational inequality
- convex program

Its complexity; the number of potential preference lists and consideration sets.

Computable instances include mine and iid scores.

Admissions coalitions and clusters. 
\pagebreak
\printbibliography

\end{document}  